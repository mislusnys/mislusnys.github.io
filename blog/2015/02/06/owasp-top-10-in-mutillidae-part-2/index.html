
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>OWASP Top 10 in Mutillidae (Part 2) - /home/mislusnys</title>
  <meta name="author" content="Mindaugas Slusnys">

  
  <meta name="description" content="This post is continuation from previous post. We explore less common, however, still potentially very dangerous OWASP Top 10 threats.
Here we go &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mislusnys.github.io/blog/2015/02/06/owasp-top-10-in-mutillidae-part-2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="/home/mislusnys" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">/home/mislusnys</a></h1>
  
    <h2>Information Security Research</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mislusnys.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">OWASP Top 10 in Mutillidae (Part 2)</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-02-06T04:29:36-05:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>This post is continuation from <a href="/blog/2015/02/03/owasp-top-10-in-mutillidae/" title="Part 1">previous post</a>. We explore less common, however, still potentially very dangerous <em>OWASP Top 10</em> threats.
Here we go through 6th to 10th places in the list.</p>

<!--more-->


<h2>A6 Sensitive Data Exposure</h2>

<p>Many web applications do not properly protect sensitive data, such as credit cards, tax IDs, and authentication credentials. Attackers may steal or modify such weakly protected data to conduct credit card fraud, identity theft, or other crimes. Sensitive data deserves extra protection such as encryption at rest or in transit, as well as special precautions when exchanged with the browser.</p>

<p>Sensitive data can be extracted from HTML storage, HTTP headers or in this example even from HTML comments in the page source code (<em>index.php</em>):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'> <span class="c">&lt;!-- I think the database password is set to blank or perhaps samurai.</span>
</span><span class='line'><span class="c">      It depends on whether you installed this web app from irongeeks site or</span>
</span><span class='line'><span class="c">      are using it inside Kevin Johnsons Samurai web testing framework.</span>
</span><span class='line'><span class="c">      It is ok to put the password in HTML comments because no user will ever see</span>
</span><span class='line'><span class="c">      this comment. I remember that security instructor saying we should use the</span>
</span><span class='line'><span class="c">      framework comment symbols (ASP.NET, JAVA, PHP, Etc.)</span>
</span><span class='line'><span class="c">      rather than HTML comments, but we all know those</span>
</span><span class='line'><span class="c">      security instructors are just making all this up. --&gt;</span>         <span class="c">&lt;!-- End Content --&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>A7 Missing Function Level Access Control</h2>

<p>Most web applications verify function level access rights before making that functionality visible in the UI. However, applications need to perform the same access control checks on the server when each function is accessed. If requests are not verified, attackers will be able to forge requests in order to access functionality without proper authorization.</p>

<p>First example in mutillidae is the <code>robots.txt</code> file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>User-agent: *
</span><span class='line'>Disallow: passwords/
</span><span class='line'>Disallow: config.inc
</span><span class='line'>Disallow: classes/
</span><span class='line'>Disallow: javascript/
</span><span class='line'>Disallow: owasp-esapi-php/
</span><span class='line'>Disallow: documentation/
</span><span class='line'>Disallow: phpmyadmin/
</span><span class='line'>Disallow: includes/
</span></code></pre></td></tr></table></div></figure>


<p>While it prevents web crawlers from indexing these files and folders, it also gives the attacker information about the structure of the website. And in this case even provides with sensitive information directly (The <em>passwords</em> folder
contains information about few legitimate accounts).</p>

<p>Another &ldquo;security by obscurity&rdquo; example is &ldquo;secret&rdquo; administrative or configuration pages. Using Burp-Intruder in sniper mode or dirbuster we could find secret pages. Sometimes they are very obvious such as
<em>secret.php, admin.php, administrator.php</em>. In our case <code>phpmyadmin.php</code> page is accessible to anyone, even anonymous user.</p>

<h2>A8 Cross-Site Request Forgery (CSRF)</h2>

<p>A CSRF attack forces a logged-on victim&rsquo;s browser to send a forged HTTP request, including the victim&rsquo;s session cookie and any other automatically included authentication information, to a vulnerable web application. This allows the attacker to force the victim&rsquo;s browser to generate requests the vulnerable application thinks are legitimate requests from the victim.</p>

<p>The <code>add-to-your-blog.php</code> page is vulnerable to CSRF. We can intercept the POST request with burp:</p>

<p><img src="/images/2015/02/06/burp.png"></p>

<p>Using this information we can construct a malicious form which submits the data upon loading the page (onload function):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">&quot;document.createElement(&#39;form&#39;).submit.call(document.getElementById(&#39;evil&#39;))&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">&quot;evil&quot;</span> <span class="na">action=</span><span class="s">&quot;http://192.168.1.66/mutillidae/index.php?page=add-to-your-blog.php&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">enctype=</span><span class="s">&quot;application/x-www-form-urlencoded&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;csrf-token&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;blog_entry&quot;</span> <span class="na">value=</span><span class="s">&quot;I made you post this!&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;add-to-your-blog-php-submit-button&quot;</span> <span class="na">value=</span><span class="s">&quot;Save+Blog+Entry&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/form&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>If logged in user (with a valid session token) visits this malicious page, then a new blog post is made on the users behalf:</p>

<p><img src="/images/2015/02/06/blog.png"></p>

<h2>A9 Using Components with Known Vulnerabilities</h2>

<p>Components, such as libraries, frameworks, and other software modules, almost always run with full privileges. If a vulnerable component is exploited, such an attack can facilitate serious data loss or server takeover. Applications using components with known vulnerabilities may undermine application defenses and enable a range of possible attacks and impacts.</p>

<p>In our case obtaining information about the server components is pretty easy (<em>phpinfo.php</em>):</p>

<p><img src="/images/2015/02/06/info.png"></p>

<p>However, in this case the server components have no known vulnerabilities (at the time of writing).</p>

<h2>A10 Unvalidated Redirects and Forwards</h2>

<p>Web applications frequently redirect and forward users to other pages and websites, and use untrusted data to determine the destination pages. Without proper validation, attackers can redirect victims to phishing or malware sites, or use forwards to access unauthorized pages.</p>

<p>In our case the credits page is vulnerable to unvalidated redirect.</p>

<pre><code>http://192.168.1.66/mutillidae/index.php?page=redirectandlog.php&amp;forwardurl=http://www.owasp.org
</code></pre>

<p>Here, the <code>forwardurl</code> specifies the redirection url and the attacker can point to a malicious page. Unvalidated redirects can increase the success rate in phishing attacks, because the first part of the link looks &ldquo;legit&rdquo;.</p>

<h2>Summary</h2>

<p><em>OWASP Top 10</em> describes most common web vulnerabilities found in the real world. <em>Mutillidae II</em> is deliberately vulnerable web application and contains at least one vulnerability from each OWASP category. It provides good
insight into majority of web related exploitation methods.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Mindaugas Slusnys</span></span>

      








  


<time datetime="2015-02-06T04:29:36-05:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/owasp/'>owasp</a>, <a class='category' href='/blog/categories/pentest/'>pentest</a>, <a class='category' href='/blog/categories/web/'>web</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/02/03/owasp-top-10-in-mutillidae/" title="Previous Post: OWASP Top 10 in Mutillidae (Part 1)">&laquo; OWASP Top 10 in Mutillidae (Part 1)</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/02/06/owasp-top-10-in-mutillidae-part-2/">OWASP Top 10 in Mutillidae (Part 2)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/03/owasp-top-10-in-mutillidae/">OWASP Top 10 in Mutillidae (Part 1)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/02/damn-vulnerable-web-application/">Exploring Damn Vulnerable Web Application</a>
      </li>
    
  </ul>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Mindaugas Slusnys -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
